# Working Log
`未尽事宜，请各自添加`

## 2018-04-14 (Append on 04-15)
>Recorder: YTom
+ 测试用车搭建完成
+ 队长交代下一阶段工作安排
+ 我自己梳理了一下程序

## 2018-04-15 
>Recorder: YTom
+ None

## 2018-04-16
>Recorder: YTom
+ 测试光编和基于光编返回值的PID程序（失败，现在主要问题是OLED显示的光编读值总是少一个，而且轮子转的时候OLED花屏）
>Recorder: Shine WONg
+ OLED 花屏之前也遇到过这个问题，可能是因为OLED执行过慢，具体原因当时也没有去细加追究，后来完成了KBITest里面用的display的库以后就没有这种问题了，建议也直接沿用KBITest里面display.c .h的库文件试试。光编我不是很清楚换过没有，反正我们车上一个光编应该是坏的，在我寝室还有一个emm.....顺便把信号发生器也拿去车队吧
+ 以及这个工作日志也不是让亲爱的杨涛学弟一个人写的，调试平衡车的工作也不是让他一个人完成，只是让他统筹安排平衡车的调试事宜。希望各位有事没事也贡献一点代码。

## 2018-04-16
>Recorder: YTom
+ 昨天的花屏问题今天一来就没有了，感觉是硬件的问题（感谢马忆飞学长），而且我已经用的display模块了。
+ 今天把PID的程序测试了一些，达到了一些效果，另外增量式的PID我测试下来不知道有点什么的问题，效果没有实现，我改成离散PID可以使用。
+ 下一步我觉得等车搭完就可以试试平衡了。

## 2018-04-18
>Recorder: lsy
+ 今日无进度更新

## 2018-04-19
>Recorder: WilliamMy
+ 读取ADC部分文件添加
+ 
## 2018-04-21 (With 0420)
>Recorder: YTom
+ 周五因为405封闭，所以我们把车拿出来了，在梁厶宇那里
+ 周五下午以及今天晚上我们简单地调了一下车，大致顺序如下：
>   * 1. 把各个功能模块放进主工程，并测试
>   * 2. 测试程序主体逻辑（时间控制和模式切换）
>   * 3. 测试PID下的速度控制
>   * 4. 将Kalman滤波结果传给PID产生速度输出（暂不考虑速度环）
>   * 5. 非道路测试：在非道路运转模式下，人为改变小车姿态能产生速度输出，且满足一定控制规律（偏差大则输出速度大）
>   * 6. 在前一步基础上实现平衡功能
+ 总体情况：程序逻辑和模块基本没有问题，主要问题在车子上的；因为新增电池问题，目前进度只达到第3步。
+ 问题：
>   * 1. 驱动板可能存在小问题（接线不牢和某个元件存在问题），导致一侧电机始终难以转起来，然而因为405问题，暂时没有工具解决；
>   * 2. 另外今天发现之前顺出来的电池没电了，最近也没法充电；
>   * 3. 可以说目前工作处于停滞状态。
+ 关于修改：
>   * 1. 修改display，以小字号显示（一面8行），因为显示内容多，所以提高一下显示效率,另外存在电机运动花屏现象（同时工作，未停止屏幕更新），考虑是中断干扰，但是看不到电机反馈还是很不方便啊；
>   * 2. 将main的初始化和循环部分做了部分拆分，一些内容封进函数里，简化代码，方便阅读；
>   * 3. 改变了一些按键检测的结构，今天发现按键效果有限，尤其是两个按键同时按下的动作（可能因为程序更复杂了，按键效果变差了），所以打算让按键动作尽可能简单，或者直接废弃（具体我再看看）；
>   * 4. 大部分变化应该是肉眼可见的那种，其他细枝末节的改变并不重要就不细说了，我的程序在成功运行前都会在ytom_t分支里。

## 2018-04-23
> by Shine Wong
+ 感觉思路非常清晰了！车队的问题的确比较无奈，驱动板的话不妨在淘宝上先买个驱动板凑合用，就一般几块钱的。
+ 关于中断的话，问了一下一个寝室的电院博士emm......他说只要中断程序的运行时间不长一般是问题不大的，然后可能需要设置一下中断优先级的问题，具体我也不是很清楚其实，还是看具体的功能是一个全局控制的还是局部的，然后来设置，试试吧嗯
+ 随便看了一下代码，对代码结构非常满意~厉害厉害

## 2018-05-05
>Recorder: lsy
+ 单纯PD调节，P=9,D=22有较小能力平衡，但逐渐拍地。加入速度控制后，原有PD不变情况下车模拍地更严重
+ 老曹说似乎应该把车模底盘和杆的角度减小，即成V形。明日决定尝试改变机械结构
+ 前瞻电感电压过小是由于黑色电感没有并联6.8nF的电容，更换蓝色电感后测得放大电压最大2.2V。但显示屏上ADC读值很飘（不排除是电感问题）

## 2018-05-06
>Recorder:My
+ PD调节，发现D的影响不尽如人意。速度环的P=20时造成车在平衡位置附近疯狂抖动。
+ 学长说可以设置倒向前方时的P比倒向后方的P更大，让车一直保持往前ps:我觉得是倒向后方的P更大才能向前

## 2018-05-08
> Recorder: YangCx
+ Prof. Wong 发现，我们的程序将调节目标值错误地储存在了陀螺仪中值（gyroMid）中，使得卡尔曼滤波值与实际角度相差约17度。
+ 将与 gyroMid 相关的程序修改，并调节了 PID 值之后，小车原有的拍地和抖动现象均有减轻，在运行起始阶段可以比较平稳地运动一段时间，之后的情况依然不理想。
+ 当前 PID_pos_p = 10, PID_pos_i = 0, PID_pos_d = 0, PID_spd_p = 14, PID_spd_i = 6, PID_spd_d = 0.

## 2018-05-09
> Recorder: My
+ Prof Wong 发现PID控制算法中，算出的值应当是速度的变化量，而不是速度的当前值。
+ 家什搬到了二楼。
+ 目前的车能在平衡位置左右晃一会，但是稍微偏转大一点就救不回来。
+ 当前 PID_pos_p = 12, PID_pos_i = 0, PID_pos_d = 44, PID_spd_p = 15, PID_spd_i = 0, PID_spd_d = 0.

## 2018-05-10
> Recorder: 严汉三
+ 安排了一下小组事宜
  - 赛车相关高级零件购置、解决主板驱动板的问题-梁厶予
  - 更换kaputt光编-严川、杨晨曦
  - 焊接赛车前瞻板、调试前瞻程序-方继冲
  - 解决通过前瞻定位赛车的问题-莫庸
  - 赛车调试-杨涛
+ 今日调车成果：小车太狡猾，一朝回到解放前，稳定性能进度倒退十年。
